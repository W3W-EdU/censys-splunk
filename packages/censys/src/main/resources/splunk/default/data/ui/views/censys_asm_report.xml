<form version="1.1">
    <label>Censys ASM Report Visual</label>
    <fieldset submitButton="false" autoRun="true">
        <input type="time" token="field1">
            <label>Logbook Time Range</label>
            <default>
                <earliest>-24h@h</earliest>
                <latest>now</latest>
            </default>
        </input>
        <input type="dropdown" token="selected_age" searchWhenChanged="true">
            <label>Risks Time Range</label>
            <choice value="86400">Last 24 hours</choice>
            <choice value="604800">Last 7 days</choice>
            <choice value="2592000">Last 30 days</choice>
            <choice value="31536000">Last year</choice>
            <default>86400</default>
        </input>
    </fieldset>
    <row>
        <panel>
            <chart>
                <title>Host Risks</title>
                <search>
                    <query>| inputlookup asm_risk_instances_lookup |eval
                        _time=strptime(lastUpdatedAt, "%Y-%m-%dT%H:%M:%S") |eval age=(now() - _time)
                        | where age &lt;= $selected_age$
                        | search type=host
                        | stats count by status</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="charting.drilldown">all</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="risk_status">$click.value$</set>
                    <set token="asset_type">host</set>
                    <set token="risky_ports">*</set>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Web Entity Risks</title>
                <search>
                    <query>| inputlookup asm_risk_instances_lookup |eval
                        _time=strptime(lastUpdatedAt, "%Y-%m-%dT%H:%M:%S") |eval age=(now() - _time)
                        | where age &lt;= $selected_age$
                        | search type=webentity
                        | stats count by status</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="charting.drilldown">all</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="risk_status">$click.value$</set>
                    <set token="asset_type">webentity</set>
                    <set token="risky_ports">*</set>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Domain Risks</title>
                <search>
                    <query>| inputlookup asm_risk_instances_lookup |eval
                        _time=strptime(lastUpdatedAt, "%Y-%m-%dT%H:%M:%S") |eval age=(now() - _time)
                        | where age &lt;= $selected_age$
                        | search type=domain
                        | stats count by status</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="risk_status">$click.value$</set>
                    <set token="asset_type">domain</set>
                    <set token="risky_ports">*</set>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Storage Bucket Risks</title>
                <search>
                    <query>| inputlookup asm_risk_instances_lookup |eval
                        _time=strptime(lastUpdatedAt, "%Y-%m-%dT%H:%M:%S") |eval age=(now() - _time)
                        | where age &lt;= $selected_age$
                        | search type=bucket
                        | stats count by status</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="risk_status">$click.value$</set>
                    <set token="asset_type">bucket</set>
                    <set token="risky_ports">*</set>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Risky Ports</title>
                <search>
                    <query>| inputlookup asm_risk_instances_lookup |eval
                        _time=strptime(lastUpdatedAt, "%Y-%m-%dT%H:%M:%S")
                        |eval age=(now() - _time) | where age &lt;= $selected_age$
                        |search (port=22 OR port=21 OR port=23 OR port=25 OR port=53 OR port=80 OR
                        port=110 OR port=143 OR port=443 OR port=3389) | stats count by status</query>
                    <earliest>-24h@h</earliest>
                    <latest>now</latest>
                </search>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart">pie</option>
                <option name="charting.chart.showDataLabels">all</option>
                <option name="charting.drilldown">all</option>
                <option name="charting.layout.splitSeries">0</option>
                <option name="charting.legend.placement">none</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="risky_ports">port=22 OR port=21 OR port=23 OR port=25 OR port=53 OR
                        port=80 OR port=110 OR port=143 OR port=443 OR port=3389</set>
                    <set token="asset_type">*</set>
                    <set token="risk_status">$click.value$</set>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Vulnerabilities</title>
                <search>
                    <query>sourcetype="censys:asm:logbook" type=HOST_VULNERABILITY | stats count by
                        operation</query>
                    <earliest>$field1.earliest$</earliest>
                    <latest>$field1.latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="charting.drilldown">all</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="selected_type">HOST_VULNERABILITY</set>
                    <set token="event_operation">$click.value$</set>
                </drilldown>
            </chart>
        </panel>
    </row>
    <row>
        <panel>
            <chart>
                <title>Hosts</title>
                <search>
                    <query>sourcetype="censys:asm:logbook" type=HOST | stats count by operation</query>
                    <earliest>$field1.earliest$</earliest>
                    <latest>$field1.latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="event_operation">$click.value$</set>
                    <set token="selected_type">HOST</set>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Ports</title>
                <search>
                    <query>sourcetype="censys:asm:logbook" type= HOST_PORT| stats count by operation</query>
                    <earliest>$field1.earliest$</earliest>
                    <latest>$field1.latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="event_operation">$click.value$</set>
                    <set token="selected_type">HOST_PORT</set>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Protocols</title>
                <search>
                    <query>sourcetype="censys:asm:logbook" type=HOST_PROTOCOL | stats count by
                        operation</query>
                    <earliest>$field1.earliest$</earliest>
                    <latest>$field1.latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="event_operation">$click.value$</set>
                    <set token="selected_type">HOST_PROTOCOL</set>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Certificates</title>
                <search>
                    <query>sourcetype="censys:asm:logbook" type=CERT | stats count by operation</query>
                    <earliest>$field1.earliest$</earliest>
                    <latest>$field1.latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="event_operation">$click.value$</set>
                    <set token="selected_type">CERT</set>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Software</title>
                <search>
                    <query>sourcetype="censys:asm:logbook" type=HOST_SOFTWARE | stats count by
                        operation</query>
                    <earliest>$field1.earliest$</earliest>
                    <latest>$field1.latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="event_operation">$click.value$</set>
                    <set token="selected_type">HOST_SOFTWARE</set>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Storage Buckets</title>
                <search>
                    <query>sourcetype="censys:asm:logbook" type=OBJECT_STORAGE | stats count by
                        operation</query>
                    <earliest>$field1.earliest$</earliest>
                    <latest>$field1.latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="event_operation">$click.value$</set>
                    <set token="selected_type">OBJECT_STORAGE</set>
                    <set token="event_operation">$row.operation$</set>
                </drilldown>
            </chart>
        </panel>
    </row>
    <row>
        <panel>
            <chart>
                <title>Domains</title>
                <search>
                    <query>sourcetype="censys:asm:logbook" type=DOMAIN | stats count by operation</query>
                    <earliest>$field1.earliest$</earliest>
                    <latest>$field1.latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="selected_type">DOMAIN</set>
                    <set token="event_operation">$row.operation$</set>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Subdomains</title>
                <search>
                    <query>sourcetype="censys:asm:logbook" type=DOMAIN_SUBDOMAIN | stats count by
                        operation</query>
                    <earliest>$field1.earliest$</earliest>
                    <latest>$field1.latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="selected_type">DOMAIN_SUBDOMAIN</set>
                    <set token="event_operation">$row.operation$</set>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Domain Expiration</title>
                <search>
                    <query>sourcetype="censys:asm:logbook" type=DOMAIN_EXPIRATION_DATE | stats count
                        by operation</query>
                    <earliest>$field1.earliest$</earliest>
                    <latest>$field1.latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="selected_type">DOMAIN_EXPIRATION_DATE</set>
                    <set token="event_operation">$row.operation$</set>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Domain Registrar</title>
                <search>
                    <query>sourcetype="censys:asm:logbook" type=DOMAIN_REGISTRAR | stats count by
                        operation</query>
                    <earliest>$field1.earliest$</earliest>
                    <latest>$field1.latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="selected_type">DOMAIN_REGISTRAR</set>
                    <set token="event_operation">$row.operation$</set>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Mail Exchange Server</title>
                <search>
                    <query>sourcetype="censys:asm:logbook" type=DOMAIN_MAIL_EXCHANGE_SERVER | stats
                        count by operation</query>
                    <earliest>$field1.earliest$</earliest>
                    <latest>$field1.latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="selected_type">DOMAIN_MAIL_EXCHANGE_SERVER</set>
                    <set token="event_operation">$row.operation$</set>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Name Server</title>
                <search>
                    <query>sourcetype="censys:asm:logbook" type=DOMAIN_NAME_SERVER | stats count by
                        operation</query>
                    <earliest>$field1.earliest$</earliest>
                    <latest>$field1.latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="height">100</option>
                <drilldown>
                    <set token="selected_type">DOMAIN_NAME_SERVER</set>
                    <set token="event_operation">$row.operation$</set>
                </drilldown>
            </chart>
        </panel>
    </row>
    <row>
        <panel>
            <table>
                <title>Logbook Events</title>
                <search>
                    <query>sourcetype="censys:asm:logbook"
                        | search type=$selected_type$ operation=$event_operation$
                        | spath _raw
                        | table type, operation, entity.*, data.*</query>
                    <earliest>-24h@h</earliest>
                    <latest>now</latest>
                </search>
                <option name="drilldown">none</option>
            </table>
        </panel>
        <panel>
            <table>
                <title>Risk Events</title>
                <search>
                    <query>| inputlookup asm_risk_instances_lookup |eval
                        _time=strptime(lastUpdatedAt, "%Y-%m-%dT%H:%M:%S") |eval age=(now() - _time)
                        | where age &lt;= $selected_age$
                        | search (type=$asset_type$ status=$risk_status$ ) AND ($risky_ports$)
                        | lookup asm_risk_types_lookup id as typeID OUTPUT remediations | table
                        displayName, ip, name, severity, status, type, port, remediations</query>
                    <earliest>-24h@h</earliest>
                    <latest>now</latest>
                </search>
                <option name="drilldown">none</option>
                <option name="refresh.display">progressbar</option>
            </table>
        </panel>
    </row>
</form>
