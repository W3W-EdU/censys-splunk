[default]
disabled = 0

# Logbook saved searches

[Hosts Added by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="HOST" operation="ASSOCIATE" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[Hosts Removed by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="HOST" operation="DISASSOCIATE" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[Software Added by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="HOST_SOFTWARE" operation="ADD" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[Software Removed by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="HOST_SOFTWARE" operation="REMOVE" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[Subdomains Added by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="DOMAIN_SUBDOMAIN" operation="ADD" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[Subdomains Removed by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="DOMAIN_SUBDOMAIN" operation="REMOVE" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[Ports Added by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="HOST_PORT" operation="ADD" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[Ports Removed by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="HOST_PORT" operation="REMOVE" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[Protocols Added by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="HOST_PROTOCOL" operation="ADD" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[Protocols Removed by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="HOST_PROTOCOL" operation="REMOVE" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[Certificates Added by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="CERT" operation="ASSOCIATE" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[Certificates Removed by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="CERT" operation="DISASSOCIATE" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[CVEs Added by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="HOST_VULNERABILITY" operation="ADD" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[CVEs Removed by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="HOST_VULNERABILITY" operation="REMOVE" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[CDNs Added by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="HOST_CDN" operation="ADD" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[CDNs Removed by day]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="HOST_CDN" operation="REMOVE" | timechart count
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[Top Host Risks]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="HOST_RISK" operation="ADD" | table entity.ipAddress data.severity data.transportProtocol data.port data.title | rename entity.ipAddress as "IP Address" | rename data.severity as "Severity" | rename data.transportProtocol as "Protocol" | rename data.port as "Port" | rename data.title as "Risk" | eval sort_field=case(Severity="critical",1, Severity="high",2, Severity="medium",3, Severity="low",4) | sort sort_field | fields - sort_field
alert.track = 0
display.general.type = events
display.page.search.tab = events
display.statistics.drilldown = row

[New Host Risks by Severity]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:logbook" type="HOST_RISK" operation="ADD" | timechart count by data.severity
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

# Saved Searches to generate lookups
[Generate Risk Instances Lookup]
disabled = 1
cron_schedule = 0 * * * *
search = | censysasmriskinstances | spath | rename context.ip as ip, context.name as name, context.port as port, context.transport as transport, context.type as type, lastUpdatedAt as lastUpdatedAt, categories{}{} as categories | table id, displayName, severity, status, typeID, ip, name, port, type, lastUpdatedAt, categories | outputlookup asm_risk_instances_lookup

[Generate Risk Types Lookup]
disabled = 1
cron_schedule = 0 * * * *
# TODO: Break out subcategory into separate lookup field
search = | censysasmrisktypes | spath | rename defaultCategories{}{} as defaultCategories, remediations{} as remediations | nomv defaultCategories | nomv remediations | table id, name, description, enabled, riskCount, activeRiskCount, subjectType, contextType, defaultCategories, defaultSeverity, recommendedSeverity, remediations | outputlookup asm_risk_types_lookup

[Hosts with most risks lookup]
disabled = 1
cron_schedule = 0 * * * *
search = | inputlookup asm_risk_instances_lookup where status=open | stats count by ip | table count, ip | sort - count | outputlookup asm_risks_on_hosts_lookup

[Hosts with most risks with severities]
disabled = 1
cron_schedule = 0 * * * *
search = | inputlookup asm_risk_instances_lookup where status=open | lookup asm_risks_on_hosts_lookup ip | sort - count | dedup ip displayName |fields count, ip, severity | mvcombine severity | sort - count | foreach ip [eval critical=mvfind(severity, "critical") | eval high=mvfind(severity, "high") | eval medium=mvfind(severity, "medium") | eval low=mvfind(severity, "low")] | foreach ip [eval highestSeverity = if(critical!="", "critical", if(high!="", "high", if(medium!="", "medium", "low")))] | fields count ip highestSeverity | outputlookup asm_risks_on_hosts_severity_lookup

[Hosts with most risks with types]
disabled = 1
cron_schedule = 0 * * * *
search = | inputlookup asm_risk_instances_lookup where status=open | lookup asm_risks_on_hosts_lookup ip | sort - count | dedup ip displayName |fields count, displayName, ip | mvcombine delim="," displayName | sort - count | eval riskTypes=displayName | fields count ip riskTypes | outputlookup asm_risks_on_hosts_types_lookup

# Risks Saved Searches

[Risk Events Enriched]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = sourcetype="censys:asm:risks" | lookup asm_risk_instances_lookup id AS riskID OUTPUTNEW displayName AS riskDisplayName, typeID AS riskType, status AS riskStatus, severity AS riskSeverity |  table id, op, reason, riskID, riskDisplayName, riskType, riskStatus, riskSeverity, delta.*
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[Risk Instances with Remediations]
action.email.sendresults = 0
dispatch.ttl = 3600
displayview = search
relation = None
request.ui_dispatch_view = search
search = | inputlookup asm_risk_instances_lookup where status=open | lookup asm_risk_types_lookup id as typeID OUTPUT remediations
alert.track = 0
display.general.type = statistics
display.page.search.tab = statistics

[Hosts with Most Risk Instances]
search = | inputlookup asm_risk_instances_lookup where status=open | stats count by ip | table count, ip | sort - count

[Top Risk Types]
search = | inputlookup asm_risk_instances_lookup where status=open | lookup asm_risk_types_lookup id as typeID OUTPUT remediations | top limit=10 typeID, displayName, remediations | table displayName, remediations, count | sort - count
